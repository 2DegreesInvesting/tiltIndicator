<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="tiltIndicator">
<title>Product sector transition risk • tiltIndicator</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Product sector transition risk">
<meta property="og:description" content="tiltIndicator">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">tiltIndicator</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/indicator-docs.html">Please help me document your indicator</a>
    <a class="dropdown-item" href="../articles/product-sector-transition-risk.html">Product sector transition risk</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Product sector transition risk</h1>
                        <h4 data-toc-skip class="author">Linda
Delacombaz</h4>
            
      
      
      <div class="d-none name"><code>product-sector-transition-risk.Rmd</code></div>
    </div>

    
    
<div class="section level4">
<h4 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h4>
<p>Packages</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://2degreesinvesting.github.io/tiltIndicator/">tiltIndicator</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="functions">Functions<a class="anchor" aria-label="anchor" href="#functions"></a>
</h4>
<p>To be done</p>
</div>
<div class="section level4">
<h4 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h4>
<ol style="list-style-type: decimal">
<li>Demo companies toy data set that has the company name along with its
products, sector and subsector information.</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">demo_companies</span> <span class="op">&lt;-</span> <span class="fu">tiltIndicator</span><span class="fu">::</span><span class="va"><a href="../reference/companies.html">companies</a></span></span>
<span></span>
<span><span class="va">demo_companies</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 5</span></span></span>
<span><span class="co">#&gt;    company_id company_name       products              sector          subsector</span></span>
<span><span class="co">#&gt;         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>          1 Peasant Peter      screws                steel_metal_tr… bending_…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>          2 Peasant Peter      aluminium_alloy       steel_metals    aluminiu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>          3 Peasant Peter      ultrafilstration      cars            vehicle_…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>          4 Peasant Paul       frozen_food           frozen_food     cheese_s…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>          5 Tom's Car Company  oils                  cars            automobi…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>          6 Tom's Car Company  bolts                 steel_metal_tr… bending_…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>          7 Screwdriver Expert chucks                steel_metal_tr… boring_s…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>          8 Screwdriver Expert adaptator_plate       steel_metal_tr… boring_s…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>          9 John Meier's Cars  disinfection_products cars            vehicle_…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>         10 John Meier's Cars  ultrafilstration      cars            vehicle_…</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Mapper, which serves as a sector classification bridge between the
Europages’ sectors and subsectors and the WEO 2022 file.</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ep_weo_mapper</span> <span class="op">&lt;-</span> <span class="fu">tiltIndicator</span><span class="fu">::</span><span class="va"><a href="../reference/ep_weo.html">ep_weo</a></span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ep_weo_mapper</span><span class="op">)</span></span>
<span><span class="co">#&gt;  EP_categories_id     EP_group          EP_sector         EP_subsector      </span></span>
<span><span class="co">#&gt;  Length:133         Length:133         Length:133         Length:133        </span></span>
<span><span class="co">#&gt;  Class :character   Class :character   Class :character   Class :character  </span></span>
<span><span class="co">#&gt;  Mode  :character   Mode  :character   Mode  :character   Mode  :character  </span></span>
<span><span class="co">#&gt;  weo_product_mapper weo_flow_mapper   </span></span>
<span><span class="co">#&gt;  Length:133         Length:133        </span></span>
<span><span class="co">#&gt;  Class :character   Class :character  </span></span>
<span><span class="co">#&gt;  Mode  :character   Mode  :character</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>WEO file that contains the scenario, year, product and reductions
information.</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weo_2022</span> <span class="op">&lt;-</span> <span class="fu">tiltIndicator</span><span class="fu">::</span><span class="va"><a href="../reference/weo_2022.html">weo_2022</a></span></span>
<span></span>
<span><span class="va">weo_2022</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 10</span></span></span>
<span><span class="co">#&gt;   publication          scenario region category product flow  unit   year  value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> World Energy Outloo… Stated … world  co2 com… Total   Road… mt c…  <span style="text-decoration: underline;">2</span>020 2.79<span style="color: #949494;">e</span>3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> World Energy Outloo… Net Zer… world  co2 com… Total   Road… mt c…  <span style="text-decoration: underline;">2</span>030 1.63<span style="color: #949494;">e</span>3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> World Energy Outloo… Net Zer… world  co2 com… Total   Road… mt c…  <span style="text-decoration: underline;">2</span>040 5.47<span style="color: #949494;">e</span>2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> World Energy Outloo… Net Zer… world  co2 com… Total   Road… mt c…  <span style="text-decoration: underline;">2</span>050 8.46<span style="color: #949494;">e</span>1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> World Energy Outloo… Stated … world  co2 com… Total   Iron… mt c…  <span style="text-decoration: underline;">2</span>020 2.59<span style="color: #949494;">e</span>3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> World Energy Outloo… Net Zer… world  co2 com… Total   Iron… mt c…  <span style="text-decoration: underline;">2</span>030 1.95<span style="color: #949494;">e</span>2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> World Energy Outloo… Net Zer… world  co2 com… Total   Iron… mt c…  <span style="text-decoration: underline;">2</span>040 1.01<span style="color: #949494;">e</span>4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> World Energy Outloo… Net Zer… world  co2 com… Total   Iron… mt c…  <span style="text-decoration: underline;">2</span>050 7.43<span style="color: #949494;">e</span>3</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: reductions &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="analysis">Analysis<a class="anchor" aria-label="anchor" href="#analysis"></a>
</h2>
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>The Product Sector Transition Risk Indicator measures the transition
risk of products based on the sector’s emissions targets the product
belongs to. Those sector emission reduction targets vary across
scenarios (e.g., net zero scenario or 1.5° scenario) and the time
horizon (e.g., reduction needed in 2030, 2040, 2050 to achieve the
targets).</p>
<p>After assessing each product, all the products with the same category
will be aggregated and set in relation to all products of the company.
We, therefore, derive company-level information.</p>
<p>The goal of the transition risk MVP is to create a first draft of how
the transition risk indicator would be build in code in order to convert
it into code production easily in the future.</p>
<p>The transition risk indicator consists of 4 main steps:</p>
<ul>
<li>Step 1: Matching the products to the sectors</li>
<li>Step 2: Identifying sector-specific emission reduction targets</li>
<li>Step 3: Categorizing sector emission reduction targets into high,
medium, and low product sector transition risk</li>
<li>Step 4: Aggregating on the company-level</li>
</ul>
</div>
<div class="section level3">
<h3 id="step-1-matching-the-products-to-the-sectors">Step 1: Matching the products to the sectors<a class="anchor" aria-label="anchor" href="#step-1-matching-the-products-to-the-sectors"></a>
</h3>
<p>Each product of the company will be matched to a climate-relevant
sector. For those that cannot be matched to one of the sectors, we
classify them as ‘Other’.</p>
<p>Let us print the demo companies toy data set that has the company
name along with its products, sector and subsector information.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">demo_companies</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 5</span></span></span>
<span><span class="co">#&gt;    company_id company_name       products              sector          subsector</span></span>
<span><span class="co">#&gt;         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>          1 Peasant Peter      screws                steel_metal_tr… bending_…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>          2 Peasant Peter      aluminium_alloy       steel_metals    aluminiu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>          3 Peasant Peter      ultrafilstration      cars            vehicle_…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>          4 Peasant Paul       frozen_food           frozen_food     cheese_s…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>          5 Tom's Car Company  oils                  cars            automobi…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>          6 Tom's Car Company  bolts                 steel_metal_tr… bending_…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>          7 Screwdriver Expert chucks                steel_metal_tr… boring_s…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>          8 Screwdriver Expert adaptator_plate       steel_metal_tr… boring_s…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>          9 John Meier's Cars  disinfection_products cars            vehicle_…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>         10 John Meier's Cars  ultrafilstration      cars            vehicle_…</span></span></code></pre></div>
<p>Let us print the mapper, which serves as a sector classification
bridge between the Europages’ sectors and subsectors and the WEO 2022
file.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ep_weo_mapper</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 133 × 6</span></span></span>
<span><span class="co">#&gt;    EP_categories_id           EP_group EP_sector EP_subsector weo_product_mapper</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> d3a7a3c40afd18a7a84094226… metallu… steel_me… bending_ste… Total             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 8d926b734410de5ba68daa170… metallu… steel_me… boilers_sta… Total             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2eed5a1fd604b1d3ec561a072… metallu… steel_me… boring_stee… Total             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 157f4f5953d1a5bfee4742175… metallu… steel_me… brazing_ste… Total             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2092de203e479b67bea023563… metallu… steel_me… broaching_s… Total             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 62dea331c70a02280d5f71a27… metallu… steel_me… bronzing_st… Total             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 8c02cdfddde68d166c1352fa7… metallu… steel_me… canopies_me… Total             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> e593b1156ce341881d18b8274… metallu… steel_me… chrome_plat… Total             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> b044eec1205c7ef2fde9e38db… metallu… steel_me… cleaning_st… Total             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 0880f49af456479b3e4f99c1e… metallu… steel_me… cutting_ste… Total             </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 123 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: weo_flow_mapper &lt;chr&gt;</span></span></span></code></pre></div>
<p>We join this on the sectors and subsectors columns.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">joined_df</span> <span class="op">&lt;-</span> <span class="va">demo_companies</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">ep_weo_mapper</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sector"</span> <span class="op">=</span> <span class="st">"EP_sector"</span>, <span class="st">"subsector"</span> <span class="op">=</span> <span class="st">"EP_subsector"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">joined_df</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 9</span></span></span>
<span><span class="co">#&gt;    company_id company_name   products sector subsector EP_categories_id EP_group</span></span>
<span><span class="co">#&gt;         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>          1 Peasant Peter  screws   steel… bending_… d3a7a3c40afd18a… metallu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>          2 Peasant Peter  alumini… steel… aluminiu… cff53720714f146… metallu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>          3 Peasant Peter  ultrafi… cars   vehicle_… 9518ae57fc6be29… vehicle…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>          4 Peasant Paul   frozen_… froze… cheese_s… <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>          5 Tom's Car Com… oils     cars   automobi… 0d63a8380d924eb… vehicle…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>          6 Tom's Car Com… bolts    steel… bending_… d3a7a3c40afd18a… metallu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>          7 Screwdriver E… chucks   steel… boring_s… 2eed5a1fd604b1d… metallu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>          8 Screwdriver E… adaptat… steel… boring_s… 2eed5a1fd604b1d… metallu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>          9 John Meier's … disinfe… cars   vehicle_… 9518ae57fc6be29… vehicle…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>         10 John Meier's … ultrafi… cars   vehicle_… 9518ae57fc6be29… vehicle…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: weo_product_mapper &lt;chr&gt;, weo_flow_mapper &lt;chr&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-2-identifying-sector-specific-emission-reduction-targets">Step 2: Identifying sector-specific emission reduction targets<a class="anchor" aria-label="anchor" href="#step-2-identifying-sector-specific-emission-reduction-targets"></a>
</h3>
<p>Let us print the WEO file that contains the scenario, year, product
and reductions information.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weo_2022</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 10</span></span></span>
<span><span class="co">#&gt;   publication          scenario region category product flow  unit   year  value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> World Energy Outloo… Stated … world  co2 com… Total   Road… mt c…  <span style="text-decoration: underline;">2</span>020 2.79<span style="color: #949494;">e</span>3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> World Energy Outloo… Net Zer… world  co2 com… Total   Road… mt c…  <span style="text-decoration: underline;">2</span>030 1.63<span style="color: #949494;">e</span>3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> World Energy Outloo… Net Zer… world  co2 com… Total   Road… mt c…  <span style="text-decoration: underline;">2</span>040 5.47<span style="color: #949494;">e</span>2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> World Energy Outloo… Net Zer… world  co2 com… Total   Road… mt c…  <span style="text-decoration: underline;">2</span>050 8.46<span style="color: #949494;">e</span>1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> World Energy Outloo… Stated … world  co2 com… Total   Iron… mt c…  <span style="text-decoration: underline;">2</span>020 2.59<span style="color: #949494;">e</span>3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> World Energy Outloo… Net Zer… world  co2 com… Total   Iron… mt c…  <span style="text-decoration: underline;">2</span>030 1.95<span style="color: #949494;">e</span>2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> World Energy Outloo… Net Zer… world  co2 com… Total   Iron… mt c…  <span style="text-decoration: underline;">2</span>040 1.01<span style="color: #949494;">e</span>4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> World Energy Outloo… Net Zer… world  co2 com… Total   Iron… mt c…  <span style="text-decoration: underline;">2</span>050 7.43<span style="color: #949494;">e</span>3</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: reductions &lt;dbl&gt;</span></span></span></code></pre></div>
<p>Let’s join that again with our previously joined data frame:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">final_df</span> <span class="op">&lt;-</span> <span class="va">joined_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">weo_2022</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"weo_product_mapper"</span> <span class="op">=</span> <span class="st">"product"</span>, <span class="st">"weo_flow_mapper"</span> <span class="op">=</span> <span class="st">"flow"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in left_join(joined_df, weo_2022, by = c(weo_product_mapper = "product", : Detected an unexpected many-to-many relationship between `x` and `y`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Row 1 of `x` matches multiple rows in `y`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Row 5 of `y` matches multiple rows in `x`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> If a many-to-many relationship is expected, set `relationship =</span></span>
<span><span class="co">#&gt;   "many-to-many"` to silence this warning.</span></span>
<span></span>
<span><span class="va">final_df</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 37 × 17</span></span></span>
<span><span class="co">#&gt;    company_id company_name  products  sector subsector EP_categories_id EP_group</span></span>
<span><span class="co">#&gt;         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>          1 Peasant Peter screws    steel… bending_… d3a7a3c40afd18a… metallu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>          1 Peasant Peter screws    steel… bending_… d3a7a3c40afd18a… metallu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>          1 Peasant Peter screws    steel… bending_… d3a7a3c40afd18a… metallu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>          1 Peasant Peter screws    steel… bending_… d3a7a3c40afd18a… metallu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>          2 Peasant Peter aluminiu… steel… aluminiu… cff53720714f146… metallu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>          2 Peasant Peter aluminiu… steel… aluminiu… cff53720714f146… metallu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>          2 Peasant Peter aluminiu… steel… aluminiu… cff53720714f146… metallu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>          2 Peasant Peter aluminiu… steel… aluminiu… cff53720714f146… metallu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>          3 Peasant Peter ultrafil… cars   vehicle_… 9518ae57fc6be29… vehicle…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>          3 Peasant Peter ultrafil… cars   vehicle_… 9518ae57fc6be29… vehicle…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 27 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 10 more variables: weo_product_mapper &lt;chr&gt;, weo_flow_mapper &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   publication &lt;chr&gt;, scenario &lt;chr&gt;, region &lt;chr&gt;, category &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   unit &lt;chr&gt;, year &lt;dbl&gt;, value &lt;dbl&gt;, reductions &lt;dbl&gt;</span></span></span>
<span></span>
<span><span class="va">final_df</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="st">"with_reductions.csv"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-3-categorizing-sector-emission-reduction-targets-into-high-medium-and-low-product-sector-transition-risk">Step 3: Categorizing sector emission reduction targets into high,
medium, and low product sector transition risk<a class="anchor" aria-label="anchor" href="#step-3-categorizing-sector-emission-reduction-targets-into-high-medium-and-low-product-sector-transition-risk"></a>
</h3>
<p>Let us categorize the transition risk into low, medium and high risk,
based on the value of the reductions.</p>
<ul>
<li><p>reductions ≤ 30% means low product sector transition
risk.</p></li>
<li><p>30% &lt; reductions ≤ 70% means medium product sector transition
risk.</p></li>
<li><p>reductions &gt; 70% means high product sector transition
risk.</p></li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">final_df_cat</span> <span class="op">&lt;-</span> <span class="va">final_df</span> <span class="op">|&gt;</span></span>
<span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>     transition_risk <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>       <span class="va">reductions</span> <span class="op">&lt;=</span> <span class="fl">30</span> <span class="op">~</span> <span class="st">"low"</span>,</span>
<span>       <span class="va">reductions</span> <span class="op">&gt;</span> <span class="fl">30</span> <span class="op">&amp;</span> <span class="va">reductions</span> <span class="op">&lt;=</span> <span class="fl">70</span> <span class="op">~</span> <span class="st">"medium"</span>,</span>
<span>       <span class="va">reductions</span> <span class="op">&gt;=</span> <span class="fl">70</span> <span class="op">~</span> <span class="st">"high"</span>,</span>
<span>       <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"no_sector"</span>,</span>
<span>       <span class="op">)</span></span>
<span>     <span class="op">)</span></span>
<span></span>
<span><span class="va">final_df_cat</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 37 × 18</span></span></span>
<span><span class="co">#&gt;    company_id company_name  products  sector subsector EP_categories_id EP_group</span></span>
<span><span class="co">#&gt;         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>          1 Peasant Peter screws    steel… bending_… d3a7a3c40afd18a… metallu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>          1 Peasant Peter screws    steel… bending_… d3a7a3c40afd18a… metallu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>          1 Peasant Peter screws    steel… bending_… d3a7a3c40afd18a… metallu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>          1 Peasant Peter screws    steel… bending_… d3a7a3c40afd18a… metallu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>          2 Peasant Peter aluminiu… steel… aluminiu… cff53720714f146… metallu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>          2 Peasant Peter aluminiu… steel… aluminiu… cff53720714f146… metallu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>          2 Peasant Peter aluminiu… steel… aluminiu… cff53720714f146… metallu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>          2 Peasant Peter aluminiu… steel… aluminiu… cff53720714f146… metallu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>          3 Peasant Peter ultrafil… cars   vehicle_… 9518ae57fc6be29… vehicle…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>          3 Peasant Peter ultrafil… cars   vehicle_… 9518ae57fc6be29… vehicle…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 27 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 11 more variables: weo_product_mapper &lt;chr&gt;, weo_flow_mapper &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   publication &lt;chr&gt;, scenario &lt;chr&gt;, region &lt;chr&gt;, category &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   unit &lt;chr&gt;, year &lt;dbl&gt;, value &lt;dbl&gt;, reductions &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   transition_risk &lt;chr&gt;</span></span></span>
<span></span>
<span><span class="va">final_df_cat</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="st">"with_transition_risk.csv"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-4-aggregating-on-the-company-level">Step 4: Aggregating on the company-level<a class="anchor" aria-label="anchor" href="#step-4-aggregating-on-the-company-level"></a>
</h3>
<p>To derive a company-level indicator for a company that has more than
one product in its portfolio, it is necessary to aggregate the Product
sector transition Risk Indicator of each product into one indicator. The
proposed method for that is to assume the same weights for each
product.</p>
<p>Here are the calculation rules:</p>
<ul>
<li><p>High Sector Transition Risk Products (in %) = ∑ of all high
sector transition risk products / ∑ of all products</p></li>
<li><p>Medium Sector Transition Risk Products (in %) = ∑ of all medium
sector transition risk products / ∑ of all products</p></li>
<li><p>Low Sector Transition Risk Products (in %) = ∑ of all low sector
transition risk products / ∑ of all products</p></li>
<li><p>No Sector Transition Risk Products (in %) = ∑ of all no sector
transition risk products / ∑ of all products</p></li>
</ul>
<p>Here I calculate the numbers of products per companies in a new
column, and join the data frame to have the data with the numbers of
products that a company produces.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_products_per_companies</span> <span class="op">&lt;-</span> <span class="va">demo_companies</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">company_name</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>total_products_per_company <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">final_df_cat</span> <span class="op">&lt;-</span> <span class="va">final_df_cat</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">n_products_per_companies</span>, by <span class="op">=</span> <span class="st">'company_name'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">final_df_cat</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 37 × 19</span></span></span>
<span><span class="co">#&gt;    company_id company_name  products  sector subsector EP_categories_id EP_group</span></span>
<span><span class="co">#&gt;         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>          1 Peasant Peter screws    steel… bending_… d3a7a3c40afd18a… metallu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>          1 Peasant Peter screws    steel… bending_… d3a7a3c40afd18a… metallu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>          1 Peasant Peter screws    steel… bending_… d3a7a3c40afd18a… metallu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>          1 Peasant Peter screws    steel… bending_… d3a7a3c40afd18a… metallu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>          2 Peasant Peter aluminiu… steel… aluminiu… cff53720714f146… metallu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>          2 Peasant Peter aluminiu… steel… aluminiu… cff53720714f146… metallu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>          2 Peasant Peter aluminiu… steel… aluminiu… cff53720714f146… metallu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>          2 Peasant Peter aluminiu… steel… aluminiu… cff53720714f146… metallu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>          3 Peasant Peter ultrafil… cars   vehicle_… 9518ae57fc6be29… vehicle…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>          3 Peasant Peter ultrafil… cars   vehicle_… 9518ae57fc6be29… vehicle…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 27 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 12 more variables: weo_product_mapper &lt;chr&gt;, weo_flow_mapper &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   publication &lt;chr&gt;, scenario &lt;chr&gt;, region &lt;chr&gt;, category &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   unit &lt;chr&gt;, year &lt;dbl&gt;, value &lt;dbl&gt;, reductions &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   transition_risk &lt;chr&gt;, total_products_per_company &lt;int&gt;</span></span></span></code></pre></div>
<p>Then, I calculate the score aggregated by summing (per transition
risk) the products over the total numbers of products per company.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aggregated_score_df</span> <span class="op">&lt;-</span> <span class="va">final_df_cat</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">company_id</span>, <span class="va">company_name</span>, <span class="va">transition_risk</span>, <span class="va">total_products_per_company</span>, <span class="va">scenario</span>, <span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">company_name</span>, <span class="va">transition_risk</span>, <span class="va">scenario</span>, <span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>score_aggregated <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">/</span><span class="va">total_products_per_company</span><span class="op">*</span><span class="fl">100</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">'keep'</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct_all.html" class="external-link">distinct_all</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Returning more (or less) than 1 row per `summarise()` group was deprecated in</span></span>
<span><span class="co">#&gt; dplyr 1.1.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `reframe()` instead.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> When switching from `summarise()` to `reframe()`, remember that `reframe()`</span></span>
<span><span class="co">#&gt;   always returns an ungrouped data frame and adjust accordingly.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span>
<span></span>
<span><span class="va">aggregated_score_df</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 19 × 5</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   company_name, transition_risk, scenario, year [19]</span></span></span>
<span><span class="co">#&gt;    company_name       transition_risk scenario             year score_aggregated</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> John Meier's Cars  high            Net Zero Emissions…  <span style="text-decoration: underline;">2</span>040            100  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> John Meier's Cars  high            Net Zero Emissions…  <span style="text-decoration: underline;">2</span>050            100  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> John Meier's Cars  low             Stated Policies Sc…  <span style="text-decoration: underline;">2</span>020            100  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> John Meier's Cars  medium          Net Zero Emissions…  <span style="text-decoration: underline;">2</span>030            100  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Peasant Paul       no_sector       <span style="color: #BB0000;">NA</span>                     <span style="color: #BB0000;">NA</span>            100  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Peasant Peter      high            Net Zero Emissions…  <span style="text-decoration: underline;">2</span>040             33.3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Peasant Peter      high            Net Zero Emissions…  <span style="text-decoration: underline;">2</span>050            100  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Peasant Peter      low             Stated Policies Sc…  <span style="text-decoration: underline;">2</span>020            100  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Peasant Peter      medium          Net Zero Emissions…  <span style="text-decoration: underline;">2</span>030            100  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Peasant Peter      medium          Net Zero Emissions…  <span style="text-decoration: underline;">2</span>040             66.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> Screwdriver Expert high            Net Zero Emissions…  <span style="text-decoration: underline;">2</span>050            100  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> Screwdriver Expert low             Stated Policies Sc…  <span style="text-decoration: underline;">2</span>020            100  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> Screwdriver Expert medium          Net Zero Emissions…  <span style="text-decoration: underline;">2</span>030            100  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> Screwdriver Expert medium          Net Zero Emissions…  <span style="text-decoration: underline;">2</span>040            100  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> Tom's Car Company  high            Net Zero Emissions…  <span style="text-decoration: underline;">2</span>040             50  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> Tom's Car Company  high            Net Zero Emissions…  <span style="text-decoration: underline;">2</span>050            100  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span> Tom's Car Company  low             Stated Policies Sc…  <span style="text-decoration: underline;">2</span>020            100  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span> Tom's Car Company  medium          Net Zero Emissions…  <span style="text-decoration: underline;">2</span>030            100  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span> Tom's Car Company  medium          Net Zero Emissions…  <span style="text-decoration: underline;">2</span>040             50</span></span>
<span></span>
<span><span class="va">aggregated_score_df</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="st">"with_score_aggregated.csv"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-5-vizualisation-example">Step 5: Vizualisation example<a class="anchor" aria-label="anchor" href="#step-5-vizualisation-example"></a>
</h3>
<p>Let us plot the result for the Peasant Peter company.</p>
<p>The score aggregated is the percentage of products of that company
that are in either low, medium or high transition risk, relatively to a
scenario and year that the user could chose, for example.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">level_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'low'</span>, <span class="st">'medium'</span>, <span class="st">'high'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">aggregated_score_df</span>  <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">company_name</span> <span class="op">==</span> <span class="st">"Peasant Peter"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">transition_risk</span>, y <span class="op">=</span> <span class="va">score_aggregated</span>, fill <span class="op">=</span> <span class="va">score_aggregated</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="va">level_order</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient2</a></span><span class="op">(</span>midpoint <span class="op">=</span> <span class="fl">0</span>, low <span class="op">=</span> <span class="st">"red"</span>, high <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">company_name</span> <span class="op">~</span> <span class="va">scenario</span><span class="op">+</span><span class="va">year</span><span class="op">)</span></span></code></pre></div>
<p><img src="product-sector-transition-risk_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Mauro Lepore, Tilman Trompke, Linda Delacombaz, 2 Degrees Investing Initiative.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
