<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="tiltIndicator">
<title>Product carbon transition risk (pctr) • tiltIndicator</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Product carbon transition risk (pctr)">
<meta property="og:description" content="tiltIndicator">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">tiltIndicator</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9012</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/indicator-docs.html">Please help me document your indicator</a>
    <a class="dropdown-item" href="../articles/pctr.html">Product carbon transition risk (pctr)</a>
    <a class="dropdown-item" href="../articles/pstr.html">Product sector transition risk (pstr)</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/2DegreesInvesting/tiltIndicator/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Product carbon transition risk (pctr)</h1>
                        <h4 data-toc-skip class="author">Tilman
Trompke</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/2DegreesInvesting/tiltIndicator/blob/HEAD/vignettes/articles/pctr.Rmd" class="external-link"><code>vignettes/articles/pctr.Rmd</code></a></small>
      <div class="d-none name"><code>pctr.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>Packages</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/2DegreesInvesting/tiltIndicator" class="external-link">tiltIndicator</a></span><span class="op">)</span></span></code></pre></div>
<p>The tiltIndicator package comes with example datasets for the PCTR
indicator.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ecoinvent_co2</span> <span class="op">&lt;-</span> <span class="va">pctr_ecoinvent_co2</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 25</span></span>
<span><span class="co">#&gt; Columns: 9</span></span>
<span><span class="co">#&gt; $ activity_product_uuid <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "0a242b09-772a-5edf-8e82-9cb4ba52a258_ae39ee61-d…</span></span>
<span><span class="co">#&gt; $ ei_activity           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "transport, freight, lorry 7.5-16 metric ton, EU…</span></span>
<span><span class="co">#&gt; $ geo                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "RoW", "GLO", "RER", "GLO", "GLO", "RER", "RoW",…</span></span>
<span><span class="co">#&gt; $ sec                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Transport", "Waste Treatment &amp; Recycling", "Tra…</span></span>
<span><span class="co">#&gt; $ isic_class            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "4923:Freight transport by road", "3822:Treatmen…</span></span>
<span><span class="co">#&gt; $ ref_prod              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "transport, freight, lorry 7.5-16 metric ton, EU…</span></span>
<span><span class="co">#&gt; $ unit                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "metric ton*km", "kg", "metric ton*km", "kg", "m…</span></span>
<span><span class="co">#&gt; $ co2_footprint         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 4.332158, 3.944488, 6.256538, 6.988420, 7.834485…</span></span>
<span><span class="co">#&gt; $ emissions_unit        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "per product unit", "per product unit", "per pro…</span></span>
<span></span>
<span><span class="va">companies</span> <span class="op">&lt;-</span> <span class="va">pctr_companies</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 25</span></span>
<span><span class="co">#&gt; Columns: 6</span></span>
<span><span class="co">#&gt; $ company_id            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "powerstartmanufacturinggmbh_0000000546010082730…</span></span>
<span><span class="co">#&gt; $ company_name          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "powerstart_manufacturing_gmbh", "powerstart_man…</span></span>
<span><span class="co">#&gt; $ ep_product            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "mining_and_quarrying_machinery_and_equipment", …</span></span>
<span><span class="co">#&gt; $ activity_product_uuid <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "0a242b09-772a-5edf-8e82-9cb4ba52a258_ae39ee61-d…</span></span>
<span><span class="co">#&gt; $ ei_activity           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "transport, freight, lorry 7.5-16 metric ton, EU…</span></span>
<span><span class="co">#&gt; $ unit                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "metric ton*km", "kg", "metric ton*km", "kg", "m…</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="analysis">Analysis<a class="anchor" aria-label="anchor" href="#analysis"></a>
</h2>
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>The Product Carbon Transition Risk measures the transition risk on
the product-level of a company. The indicator is expressed in the
percentage of all products that are at high risk, medium risk or low
risk due to the products’ relative carbon footprint. The assessment is
first performed on a product-level and can then be aggregated to the
company-level.</p>
<p>The Product Carbon Transition Risk measures the relative carbon
footprint per product. As a default option each product will be compared
to the carbon footprint of every other product. Alternatively, users can
also choose to compare those products of the same type, so e.g.,
comparing only raw materials with each other. Products with a higher
carbon-footprint will also face a higher risk.</p>
<p>After identifying each carbon footprint for one product, the products
will be ranked according to their carbon footprint. Products in the
highest percentile (≥70%) will be classified as high transition risk
products. Products in the medium percentile (between ≥30% and &lt;70%)
will be classified as medium transition risk products. Products in the
lowest percentile (&lt;30%) will be classified as low transition risk
products.</p>
<p>After categorisation, we will aggregate all products from the same
category and set them in relation to all products that the company
produces. We derive the Product Carbon Transition Risks.</p>
<p>Please note that carbon footprints, and emissions are used
equivalently. Carbon footprint refers only on the emissions which occur
at the production stage of the product and not the emissions from the
inputs. The unit is CO2e in kg.</p>
<p>The goal of the transition risk MVP is to create a first draft of how
the transition risk indicator for products would be build in code in
order to convert it into code production easily in the future. This MVP
should provide the share of products with “low”, “medium”, or “high”
relative production emissions per company.</p>
<p>In this markdown file the aim is to prepare data so that they contain
the following:</p>
<ul>
<li>a column with production emissions</li>
<li>a column indicating the percentile relative to (i) all products with
same unit (ii) products in same sector (iii) products in same
segment</li>
<li>a column indicating whether the product has “low”, “medium” or
“high” relative production emissions</li>
</ul>
<p>The product carbon transition risk indicator consists of 2 main
steps:</p>
<ul>
<li>Step 1: Calculate ranks per activity and assign scores</li>
<li>Step 2: Calculate scores per company</li>
</ul>
</div>
<div class="section level3">
<h3 id="calculate-ranks-per-activity-and-assign-scores">1: Calculate ranks per activity and assign scores<a class="anchor" aria-label="anchor" href="#calculate-ranks-per-activity-and-assign-scores"></a>
</h3>
<div class="section level4">
<h4 id="calculate-the-rank-of-each-activity">Calculate the rank of each activity<a class="anchor" aria-label="anchor" href="#calculate-the-rank-of-each-activity"></a>
</h4>
<p>This is done based on the activities’ carbon footprint compared to 3
different benchmarks (all products, products with same unit, products
with same unit and sector)</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># rank in comparison to all products</span></span>
<span><span class="va">ecoinvent_ranks</span> <span class="op">&lt;-</span> <span class="va">ecoinvent_co2</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>perc_all <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rank.html" class="external-link">rank</a></span><span class="op">(</span><span class="va">co2_footprint</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">co2_footprint</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># rank in comparison to all products with same unit</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">unit</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>perc_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rank.html" class="external-link">rank</a></span><span class="op">(</span><span class="va">co2_footprint</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">co2_footprint</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># rank in comparison to all products with same unit and sector</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">unit</span>, <span class="va">sec</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>perc_unit_sec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rank.html" class="external-link">rank</a></span><span class="op">(</span><span class="va">co2_footprint</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">co2_footprint</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ecoinvent_ranks</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 25 × 12</span></span></span>
<span><span class="co">#&gt;    activity_product_uuid       ei_activity geo   sec   isic_class ref_prod unit </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 0a242b09-772a-5edf-8e82-9c… transport,… RoW   Tran… 4923:Frei… transpo… metr…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> be06d25c-73dc-55fb-965b-0f… treatment … GLO   Wast… 3822:Trea… residue… kg   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 977d997e-c257-5033-ba39-d0… market gro… RER   Tran… 4912:Frei… transpo… metr…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 5fd7fca0-0700-51fd-877a-72… treatment … GLO   Wast… 3821:Trea… waste p… kg   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ebb8475e-ff57-5e4e-937b-b5… market for… GLO   Infr… 2819:Manu… ventila… m    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2f7b77a7-1556-5c1b-b0aa-c4… market for… RER   Chem… 2011:Manu… sodium … kg   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> edd290d2-a5b0-56ec-aaf3-ad… transport,… RoW   Tran… 4922:Othe… transpo… km   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> d2c0844e-6e5b-52a3-802c-b1… market for… GLO   Agri… 1080:Manu… mineral… kg   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> abdb78ee-ddb9-5552-9c4c-ed… citric aci… RNA   Chem… 2011:Manu… citric … kg   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 16e1dc41-2793-521c-b4c9-81… sodium eth… ZA    Chem… 2011:Manu… sodium … kg   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 15 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5 more variables: co2_footprint &lt;dbl&gt;, emissions_unit &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   perc_all &lt;dbl&gt;, perc_unit &lt;dbl&gt;, perc_unit_sec &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="assign-scores-to-the-activities">Assign scores to the activities<a class="anchor" aria-label="anchor" href="#assign-scores-to-the-activities"></a>
</h4>
<p>This is done based on their position within the distribution of co2
footprints in comparison to different benchmarks.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># creat variables for thresholds</span></span>
<span><span class="va">low_threshold</span> <span class="op">&lt;-</span> <span class="fl">0.3</span></span>
<span><span class="va">high_threshold</span> <span class="op">&lt;-</span> <span class="fl">0.7</span></span>
<span></span>
<span><span class="co"># assign scores to position within percentile distribution</span></span>
<span><span class="co"># for all products</span></span>
<span><span class="va">ecoinvent_scores</span> <span class="op">&lt;-</span> <span class="va">ecoinvent_ranks</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    score_all <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">perc_all</span> <span class="op">&lt;</span> <span class="va">low_threshold</span> <span class="op">~</span> <span class="st">"low"</span>,</span>
<span>      <span class="va">perc_all</span> <span class="op">&gt;=</span> <span class="va">low_threshold</span> <span class="op">&amp;</span> <span class="va">perc_all</span> <span class="op">&lt;</span> <span class="va">high_threshold</span> <span class="op">~</span> <span class="st">"medium"</span>,</span>
<span>      <span class="va">perc_all</span> <span class="op">&gt;=</span> <span class="va">high_threshold</span> <span class="op">~</span> <span class="st">"high"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># for products with same unit</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    score_unit <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">perc_unit</span> <span class="op">&lt;</span> <span class="va">low_threshold</span> <span class="op">~</span> <span class="st">"low"</span>,</span>
<span>      <span class="va">perc_unit</span> <span class="op">&gt;=</span> <span class="va">low_threshold</span> <span class="op">&amp;</span> <span class="va">perc_unit</span> <span class="op">&lt;</span> <span class="va">high_threshold</span> <span class="op">~</span> <span class="st">"medium"</span>,</span>
<span>      <span class="va">perc_unit</span> <span class="op">&gt;=</span> <span class="va">low_threshold</span> <span class="op">~</span> <span class="st">"high"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># for products with same unit and sector</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    score_unit_sec <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">perc_unit_sec</span> <span class="op">&lt;</span> <span class="va">low_threshold</span> <span class="op">~</span> <span class="st">"low"</span>,</span>
<span>      <span class="va">perc_unit_sec</span> <span class="op">&gt;=</span> <span class="va">low_threshold</span> <span class="op">&amp;</span> <span class="va">perc_unit_sec</span> <span class="op">&lt;</span> <span class="va">high_threshold</span> <span class="op">~</span> <span class="st">"medium"</span>,</span>
<span>      <span class="va">perc_unit_sec</span> <span class="op">&gt;=</span> <span class="va">high_threshold</span> <span class="op">~</span> <span class="st">"high"</span>,</span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">ecoinvent_scores</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 25 × 15</span></span></span>
<span><span class="co">#&gt;    activity_product_uuid       ei_activity geo   sec   isic_class ref_prod unit </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 0a242b09-772a-5edf-8e82-9c… transport,… RoW   Tran… 4923:Frei… transpo… metr…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> be06d25c-73dc-55fb-965b-0f… treatment … GLO   Wast… 3822:Trea… residue… kg   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 977d997e-c257-5033-ba39-d0… market gro… RER   Tran… 4912:Frei… transpo… metr…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 5fd7fca0-0700-51fd-877a-72… treatment … GLO   Wast… 3821:Trea… waste p… kg   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ebb8475e-ff57-5e4e-937b-b5… market for… GLO   Infr… 2819:Manu… ventila… m    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2f7b77a7-1556-5c1b-b0aa-c4… market for… RER   Chem… 2011:Manu… sodium … kg   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> edd290d2-a5b0-56ec-aaf3-ad… transport,… RoW   Tran… 4922:Othe… transpo… km   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> d2c0844e-6e5b-52a3-802c-b1… market for… GLO   Agri… 1080:Manu… mineral… kg   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> abdb78ee-ddb9-5552-9c4c-ed… citric aci… RNA   Chem… 2011:Manu… citric … kg   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 16e1dc41-2793-521c-b4c9-81… sodium eth… ZA    Chem… 2011:Manu… sodium … kg   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 15 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 8 more variables: co2_footprint &lt;dbl&gt;, emissions_unit &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   perc_all &lt;dbl&gt;, perc_unit &lt;dbl&gt;, perc_unit_sec &lt;dbl&gt;, score_all &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   score_unit &lt;chr&gt;, score_unit_sec &lt;chr&gt;</span></span></span></code></pre></div>
<p>Show distributions</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/proportions.html" class="external-link">prop.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">ecoinvent_scores</span><span class="op">$</span><span class="va">score_all</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="pctr_files/figure-html/unnamed-chunk-8-1.png" width="100%"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/proportions.html" class="external-link">prop.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">ecoinvent_scores</span><span class="op">$</span><span class="va">score_unit</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="pctr_files/figure-html/unnamed-chunk-8-2.png" width="100%"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/proportions.html" class="external-link">prop.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">ecoinvent_scores</span><span class="op">$</span><span class="va">score_unit_sec</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="pctr_files/figure-html/unnamed-chunk-8-3.png" width="100%"></p>
</div>
</div>
<div class="section level3">
<h3 id="calculate-scores-per-company">2: Calculate scores per company<a class="anchor" aria-label="anchor" href="#calculate-scores-per-company"></a>
</h3>
<div class="section level4">
<h4 id="join-dataset-companies-and-ecoinvent_scores">Join dataset companies and ecoinvent_scores<a class="anchor" aria-label="anchor" href="#join-dataset-companies-and-ecoinvent_scores"></a>
</h4>
<p>This is needed required to combine company-level information with LCA
info from ecoinvent.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># join by activity_product_uuid and other joint columns from companies with ecoinvent_scores</span></span>
<span><span class="va">companies_scores</span> <span class="op">&lt;-</span> <span class="va">companies</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">ecoinvent_scores</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"activity_product_uuid"</span>, <span class="st">"ei_activity"</span>, <span class="st">"unit"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">companies_scores</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 25 × 18</span></span></span>
<span><span class="co">#&gt;    company_id    company_name ep_product activity_product_uuid ei_activity unit </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> powerstartma… powerstart_… mining_an… 0a242b09-772a-5edf-8… transport,… metr…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> powerstartma… powerstart_… hydraulic… be06d25c-73dc-55fb-9… treatment … kg   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> powerstartma… powerstart_… hydraulic… 977d997e-c257-5033-b… market gro… metr…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> powerstartma… powerstart_… off_the_r… 5fd7fca0-0700-51fd-8… treatment … kg   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ebtor_000000… ebtor        agricultu… ebb8475e-ff57-5e4e-9… market for… m    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> ebtor_000000… ebtor        nuts       2f7b77a7-1556-5c1b-b… market for… kg   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ebtor_000000… ebtor        pistachio  edd290d2-a5b0-56ec-a… transport,… km   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ebtor_000000… ebtor        dried_fru… d2c0844e-6e5b-52a3-8… market for… kg   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ebtor_000000… ebtor        saffron    abdb78ee-ddb9-5552-9… citric aci… kg   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> mbdgmbh_0000… mbd_gmbh     steels_an… 16e1dc41-2793-521c-b… sodium eth… kg   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 15 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 12 more variables: geo &lt;chr&gt;, sec &lt;chr&gt;, isic_class &lt;chr&gt;, ref_prod &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   co2_footprint &lt;dbl&gt;, emissions_unit &lt;chr&gt;, perc_all &lt;dbl&gt;, perc_unit &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   perc_unit_sec &lt;dbl&gt;, score_all &lt;chr&gt;, score_unit &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   score_unit_sec &lt;chr&gt;</span></span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="caclulate-the-scores-for-each-company">Caclulate the scores for each company<a class="anchor" aria-label="anchor" href="#caclulate-the-scores-for-each-company"></a>
</h4>
<p>This is done by calculating the share of products with each
score.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># scores in comparison to all products</span></span>
<span><span class="va">scores_all</span> <span class="op">&lt;-</span> <span class="va">companies_scores</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">company_id</span>, <span class="va">score_all</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>n_all <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>share_all <span class="op">=</span> <span class="va">n_all</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n_all</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">n_all</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"score"</span> <span class="op">=</span> <span class="st">"score_all"</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'company_id'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span>
<span></span>
<span><span class="va">scores_all</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 9 × 3</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   company_id [3]</span></span></span>
<span><span class="co">#&gt;   company_id                                          score  share_all</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ebtor_00000005324899621837001                       high        0.6 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ebtor_00000005324899621837001                       low         0.2 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ebtor_00000005324899621837001                       medium      0.2 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> mbdgmbh_00000004773428001                           high        0.25</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> mbdgmbh_00000004773428001                           low         0.25</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> mbdgmbh_00000004773428001                           medium      0.5 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> powerstartmanufacturinggmbh_00000005460100827307001 high        0.25</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> powerstartmanufacturinggmbh_00000005460100827307001 low         0.5 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">9</span> powerstartmanufacturinggmbh_00000005460100827307001 medium      0.25</span></span>
<span></span>
<span><span class="co"># scores in comparison to products with same unit</span></span>
<span><span class="va">scores_unit</span> <span class="op">&lt;-</span> <span class="va">companies_scores</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">company_id</span>, <span class="va">score_unit</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>n_unit <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>share_unit <span class="op">=</span> <span class="va">n_unit</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n_unit</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">n_unit</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"score"</span> <span class="op">=</span> <span class="st">"score_unit"</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'company_id'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span>
<span></span>
<span><span class="va">scores_unit</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 3</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   company_id [3]</span></span></span>
<span><span class="co">#&gt;   company_id                                          score  share_unit</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ebtor_00000005324899621837001                       high        0.6  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ebtor_00000005324899621837001                       medium      0.4  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> mbdgmbh_00000004773428001                           high        0.438</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> mbdgmbh_00000004773428001                           low         0.188</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> mbdgmbh_00000004773428001                           medium      0.375</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> powerstartmanufacturinggmbh_00000005460100827307001 high        0.5  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> powerstartmanufacturinggmbh_00000005460100827307001 low         0.25 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> powerstartmanufacturinggmbh_00000005460100827307001 medium      0.25</span></span>
<span></span>
<span><span class="co"># scores in comparison to products with same unit and sector</span></span>
<span><span class="va">scores_unit_sec</span> <span class="op">&lt;-</span> <span class="va">companies_scores</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">company_id</span>, <span class="va">score_unit_sec</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>n_unit_sec <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>share_unit_sec <span class="op">=</span> <span class="va">n_unit_sec</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n_unit_sec</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">n_unit_sec</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"score"</span> <span class="op">=</span> <span class="st">"score_unit_sec"</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'company_id'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span>
<span></span>
<span><span class="va">scores_unit_sec</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 3</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   company_id [3]</span></span></span>
<span><span class="co">#&gt;   company_id                                          score  share_unit_sec</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ebtor_00000005324899621837001                       high           0.8   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ebtor_00000005324899621837001                       medium         0.2   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> mbdgmbh_00000004773428001                           high           0.688 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> mbdgmbh_00000004773428001                           low            0.062<span style="text-decoration: underline;">5</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> mbdgmbh_00000004773428001                           medium         0.25  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> powerstartmanufacturinggmbh_00000005460100827307001 high           0.5   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> powerstartmanufacturinggmbh_00000005460100827307001 low            0.25  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> powerstartmanufacturinggmbh_00000005460100827307001 medium         0.25</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="create-final-dataset">Create final dataset<a class="anchor" aria-label="anchor" href="#create-final-dataset"></a>
</h4>
<p>The final dataset should have three rows per company, i.e. one for
each risk_group (low, medium, high) and one column each indicating the
share of products in the respective risk groups for the three different
benchmarks (all products, products with same unit, products with same
unit and sector)</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create dataset sceleton</span></span>
<span><span class="va">dt_sceleton</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  company_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">companies_scores</span><span class="op">$</span><span class="va">company_id</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>  score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"high"</span>, <span class="st">"medium"</span>, <span class="st">"low"</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># join scores with dt_sceleton so that each company is shown with 3 rows for low, medium, and high, even if the share is 0.</span></span>
<span><span class="va">pctr_output</span> <span class="op">&lt;-</span> <span class="va">dt_sceleton</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">scores_all</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"company_id"</span>, <span class="st">"score"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">scores_unit</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"company_id"</span>, <span class="st">"score"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">scores_unit_sec</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"company_id"</span>, <span class="st">"score"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># replace NAs with 0</span></span>
<span><span class="va">pctr_output</span> <span class="op">&lt;-</span> <span class="va">pctr_output</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">pctr_output</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pctr_output</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 9 × 5</span></span></span>
<span><span class="co">#&gt;   company_id                           score share_all share_unit share_unit_sec</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> powerstartmanufacturinggmbh_0000000… high       0.25      0.5           0.5   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> powerstartmanufacturinggmbh_0000000… medi…      0.25      0.25          0.25  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> powerstartmanufacturinggmbh_0000000… low        0.5       0.25          0.25  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ebtor_00000005324899621837001        high       0.6       0.6           0.8   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ebtor_00000005324899621837001        medi…      0.2       0.4           0.2   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> ebtor_00000005324899621837001        low        0.2       0             0     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> mbdgmbh_00000004773428001            high       0.25      0.438         0.688 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> mbdgmbh_00000004773428001            medi…      0.5       0.375         0.25  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">9</span> mbdgmbh_00000004773428001            low        0.25      0.188         0.062<span style="text-decoration: underline;">5</span></span></span></code></pre></div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Mauro Lepore, Tilman Trompke, Linda Delacombaz, 2 Degrees Investing Initiative.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
